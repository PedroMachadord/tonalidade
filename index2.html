<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Instrumentos Musicais</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        select {
            width: 70px;
            padding: 5px;
        }
        input[type="text"] {
            padding: 5px;
            width: 150px;
        }
        button {
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        #salvarBtn {
            background-color: #4CAF50;
        }
        #whatsappBtn {
            background-color: #25D366;
        }
        #adicionarBtn {
            background-color: #2196F3;
        }
        button:hover {
            opacity: 0.9;
        }
        .total-row {
            font-weight: bold;
            background-color: #f9f9f9;
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .novo-instrumento-row {
            background-color: #fffde7;
        }
    </style>
</head>
<body>
    <h1>Controle de Instrumentos Musicais</h1>
    
    <table id="instrumentosTable">
        <thead>
            <tr>
                <th>Instrumento</th>
                <th>Quantidade</th>
            </tr>
        </thead>
        <tbody>
            <!-- Linhas dos instrumentos serão geradas pelo JavaScript -->
        </tbody>
        <tfoot>
            <tr class="novo-instrumento-row">
                <td>
                    <input type="text" id="novoInstrumento" placeholder="Digite um novo instrumento">
                </td>
                <td>
                    <select id="quantidadeNovoInstrumento" class="quantidade">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                    <button id="adicionarBtn" style="margin-left: 10px;">Adicionar</button>
                </td>
            </tr>
            <tr>
                <td>Banco</td>
                <td>
                    <select id="banco" class="quantidade">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </td>
            </tr>
            <tr class="total-row">
                <td>Total de Instrumentos</td>
                <td id="totalInstrumentos">0</td>
            </tr>
        </tfoot>
    </table>
    
    <div class="button-container">
        <button id="salvarBtn">Salvar</button>
        <button id="whatsappBtn">Enviar por WhatsApp</button>
    </div>

    <script>
        // Lista de instrumentos
        const instrumentos = [
            "Violino",
            "Violoncelo",
            "Flauta",
            "Clarinete",
            "Clarone",
            "Sax Reto",
            "Sax Alto",
            "Sax Barítono",
            "Trompete",
            "Trombonito",
            "Trombone",
            "Eufônio",
            "Tuba"
        ];

        // Array para armazenar instrumentos adicionados pelo usuário
        let instrumentosAdicionados = [];

        // Referências DOM
        const tbody = document.querySelector("#instrumentosTable tbody");
        const totalInstrumentosCell = document.getElementById("totalInstrumentos");
        const salvarBtn = document.getElementById("salvarBtn");
        const whatsappBtn = document.getElementById("whatsappBtn");
        const adicionarBtn = document.getElementById("adicionarBtn");
        const novoInstrumentoInput = document.getElementById("novoInstrumento");
        const quantidadeNovoInstrumento = document.getElementById("quantidadeNovoInstrumento");

        // Função para criar options de 0 a 10
        function criarOptions(selectElement) {
            for (let i = 0; i <= 10; i++) {
                const option = document.createElement("option");
                option.value = i;
                option.textContent = i;
                selectElement.appendChild(option);
            }
        }

        // Função para criar uma linha na tabela para um instrumento
        function criarLinhaInstrumento(instrumento, quantidade = 0) {
            const row = document.createElement("tr");
            
            const cellInstrumento = document.createElement("td");
            cellInstrumento.textContent = instrumento;
            
            const cellQuantidade = document.createElement("td");
            const select = document.createElement("select");
            select.className = "quantidade";
            select.dataset.instrumento = instrumento;
            select.addEventListener("change", calcularTotal);
            
            criarOptions(select);
            select.value = quantidade;
            
            cellQuantidade.appendChild(select);
            row.appendChild(cellInstrumento);
            row.appendChild(cellQuantidade);
            
            return row;
        }

        // Inicializar tabela com instrumentos padrão
        instrumentos.forEach(instrumento => {
            tbody.appendChild(criarLinhaInstrumento(instrumento));
        });

        // Função para calcular o total de instrumentos
        function calcularTotal() {
            let total = 0;
            const selects = document.querySelectorAll(".quantidade");
            
            selects.forEach(select => {
                // Não incluir bancos no total
                if (select.id !== "banco" && select.id !== "quantidadeNovoInstrumento") {
                    total += parseInt(select.value) || 0;
                }
            });
            
            totalInstrumentosCell.textContent = total;
        }

        // Função para adicionar novo instrumento
        function adicionarInstrumento() {
            const nomeInstrumento = novoInstrumentoInput.value.trim();
            const quantidade = quantidadeNovoInstrumento.value;
            
            if (nomeInstrumento === "") {
                alert("Por favor, digite o nome do instrumento");
                return;
            }
            
            // Verificar se o instrumento já existe
            const todosInstrumentos = [...instrumentos, ...instrumentosAdicionados];
            if (todosInstrumentos.includes(nomeInstrumento)) {
                alert("Este instrumento já está na lista!");
                return;
            }
            
            // Adicionar à lista de instrumentos adicionados
            instrumentosAdicionados.push(nomeInstrumento);
            
            // Criar nova linha na tabela (antes da linha de novo instrumento)
            const novaLinha = criarLinhaInstrumento(nomeInstrumento, quantidade);
            tbody.insertBefore(novaLinha, tbody.lastElementChild);
            
            // Limpar campos
            novoInstrumentoInput.value = "";
            quantidadeNovoInstrumento.value = "0";
            
            // Recalcular total
            calcularTotal();
        }

        // Função para gerar o conteúdo do relatório
        function gerarConteudo() {
            const dataAtual = new Date();
            const dataFormatada = dataAtual.toLocaleDateString('pt-BR');
            const horaFormatada = dataAtual.toLocaleTimeString('pt-BR');
            
            let conteudo = `*Controle de Instrumentos Musicais*\n`;
            conteudo += `Data: ${dataFormatada} ${horaFormatada}\n\n`;
            conteudo += `*Quantidade de Instrumentos:*\n`;
            
            // Adicionar instrumentos padrão ao conteúdo
            instrumentos.forEach(instrumento => {
                const select = document.querySelector(`select[data-instrumento="${instrumento}"]`);
                const quantidade = select ? select.value : "0";
                if (parseInt(quantidade) > 0) {
                    conteudo += `➤ ${instrumento}: ${quantidade}\n`;
                }
            });
            
            // Adicionar instrumentos customizados ao conteúdo
            instrumentosAdicionados.forEach(instrumento => {
                const select = document.querySelector(`select[data-instrumento="${instrumento}"]`);
                const quantidade = select ? select.value : "0";
                if (parseInt(quantidade) > 0) {
                    conteudo += `➤ ${instrumento}: ${quantidade}\n`;
                }
            });
            
            // Adicionar banco e total
            const banco = document.getElementById("banco").value;
            const total = totalInstrumentosCell.textContent;
            
            conteudo += `\n*Bancos utilizados:* ${banco}\n`;
            conteudo += `*Total de Instrumentos:* ${total}\n`;
            
            return conteudo;
        }

        // Função para salvar os dados
        function salvarDados() {
            const conteudo = gerarConteudo();
            
            // Criar blob e link para download
            const blob = new Blob([conteudo], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `instrumentos_${new Date().getTime()}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        // Função para compartilhar via WhatsApp
        function compartilharWhatsApp() {
            const conteudo = gerarConteudo();
            const texto = encodeURIComponent(conteudo);
            const url = `https://wa.me/?text=${texto}`;
            window.open(url, '_blank');
        }

        // Event listeners
        salvarBtn.addEventListener("click", salvarDados);
        whatsappBtn.addEventListener("click", compartilharWhatsApp);
        adicionarBtn.addEventListener("click", adicionarInstrumento);
        novoInstrumentoInput.addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                adicionarInstrumento();
            }
        });

        // Calcular total inicial
        calcularTotal();
    </script>
</body>
</html>